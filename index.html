<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Live NSE Quant Scanner</title>
<style>
body{background:#020617;color:#e5e7eb;font-family:system-ui}
.container{max-width:1100px;margin:auto;padding:24px}
button{background:#22c55e;border:0;padding:12px 22px;border-radius:8px;cursor:pointer}
table{width:100%;border-collapse:collapse;margin-top:15px}
th,td{padding:10px;border-bottom:1px solid #1e293b;text-align:center}
th{color:#94a3b8}
.badge{padding:4px 10px;border-radius:999px}
.green{background:rgba(34,197,94,.2);color:#22c55e}
.status{margin-top:8px;color:#94a3b8}
</style>
</head>

<body>
<div class="container">
<h2>ðŸ“Š Live NSE Quant Scanner</h2>
<button onclick="scan()">Suggest</button>
<div class="status" id="status">Idle</div>

<table>
<thead>
<tr>
<th>Stock</th><th>CMP</th><th>Buy</th><th>SL</th><th>Target</th><th>AI %</th>
</tr>
</thead>
<tbody id="body"></tbody>
</table>
</div>

<script>
const API = "https://YOUR_WORKER_URL/screener";

function avg(a,n){return a.slice(-n).reduce((x,y)=>x+y)/n}

function aiProb(p){
  let s=0;
  if(p.at(-1)>avg(p,20))s+=30;
  if(p.at(-1)>avg(p,50))s+=20;
  if(p.at(-1)>p.at(-5)*1.02)s+=25;
  if((Math.max(...p)-Math.min(...p))/p.at(-1)>0.15)s+=10;
  return Math.min(s,80);
}

async function scan(){
  document.getElementById("status").innerText="Fetching live NSE stocksâ€¦";
  document.getElementById("body").innerHTML="";

  const r = await fetch(API);
  const data = await r.json();

  let picked=0;
  for(const s of data){
    if(picked===3)break;

    const p=s.prices;
    const prob=aiProb(p);
    if(prob<65)continue;

    const cmp=p.at(-1);
    const buy=Math.round(cmp+1);
    const sl=buy-10;
    const target=Math.round(buy*1.3);

    document.getElementById("body").innerHTML+=`
    <tr>
      <td>${s.symbol}</td>
      <td>â‚¹${cmp.toFixed(2)}</td>
      <td>â‚¹${buy}</td>
      <td>â‚¹${sl}</td>
      <td>â‚¹${target}</td>
      <td><span class="badge green">${prob}%</span></td>
    </tr>`;
    picked++;
  }

  document.getElementById("status").innerText="ðŸ”¥ Live Scan Complete";
}
</script>
</body>
</html>
